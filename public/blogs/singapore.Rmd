---
categories:
- ""
- ""
date: "2017-10-31T21:28:43-05:00"
description: ""
draft: false
image: pic01.jpg
keywords: ""
slug: airbnb
title: AirBnB
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  message = FALSE, 
  warning = FALSE, 
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code
options(digits = 3)

# default figure size
knitr::opts_chunk$set(
  fig.width=6.75, 
  fig.height=6.75,
  fig.align = "center")

#avoid scientific notation 
options(scipen=999)
```

```{r load-libraries, warning=FALSE, message=FALSE, echo=FALSE, eval = TRUE }
library(tidyverse)  # Loading packages for inspecting, wrangling, visualizing and modeling the data
library(mosaic)
library(ggthemes)
library(lubridate)
library(fivethirtyeight)
library(here)
library(skimr)
library(janitor)
library(vroom)
library(tidyquant)
library(ggthemes)
library(kableExtra)
library(ggrepel)
library(RColorBrewer)
library(scales)
library(gridExtra)
library(infer)
library(moderndive)
library(htmlTable)
library(leaflet)
library(GGally)
library(kableExtra)
library(huxtable)
library(broom)
library(fastDummies)
library(jtools)
library(ggfortify)
library(car)
```

```{r}
# Creating custom theme and palette for visualizations

# Generate the colors for the chart procedurally with RColorBrewer
palette <- brewer.pal("Greys", n=9)
color.background = palette[2]
color.grid.major = palette[3]
color.axis.text = palette[6]
color.axis.title = palette[7]
color.title = palette[9]

#setting up a fil paletter
fill_palette <- c('#EAAEAE' , '#E8C29C'  , '#E4B181' , '#DE9754')

#creating custom theme
theme_cust <- theme_minimal(base_size = 13) +
  theme(
    #formatting the axis
    axis.line = element_blank() ,
    axis.text=element_text(size=10,color=color.axis.text, face = 'bold', family = 'Helvetica'),
    axis.title = element_text(size=13,color=color.axis.text , face = 'bold', family = 'Helvetica'),
    
    #formatiing title
    plot.title = element_text(size=16,color=color.axis.text , face = 'bold', family = 'Helvetica'),
    plot.subtitle = element_text(size=13,color=color.axis.text , family = 'Helvetica' , face = 'bold'),
    
    
    #panel background
    panel.background = element_rect(fill = color.background , color = color.background),
    
    #plot background 
    plot.background = element_rect(fill = color.background , color = color.background),
    
    # Format the grid
   panel.grid.minor=element_line(color=color.grid.major,size=.25) 
   
   #legend posiition
  )
```

# Predicting prices for AirBnBs

In this project I will be analysing data about Airbnb listings in Singapore with the goal of building a model to predict the total cost for two people staying four nights in Singapore. The data is from [insideairbnb.com]()

```{r load data}
#importing the raw data from insideairbnb.com 
df_raw <- read_csv("listings.csv")
```

## Inspecting and cleaning the data 

```{r, cache=TRUE, eval = TRUE, echo = FALSE }
#glimpsing the data frame to get a sense of the raw data
glimpse(df_raw)
```
```{r, cache=TRUE, eval = TRUE, echo = FALSE }
#Skim for further inspection of the data frame 
skimr::skim(df_raw)
```
An initial inspection using the `glimpse` and `skim` functions above shows that the raw data consists of 7323 observations (rows) and 106 variables (columns) and includes both quantitative and qualitative information on AirBnBs in Singapore. It revealed numerous duplicated observations and many missing values which I proceed to remove, alongside any irrelevant variables. Lastly, some quantitative variables (eg. price, cleaning_fee, extra_people) appear with the wrong data type, which I change into numerical. 

Some of the main variables analyzed are described below, with cost data typically expressed in US$: 
- `price` = cost per night
- `cleaning_fee`: cleaning fee
- `extra_people`: charge for having more than 1 person
- `property_type`: type of accommodation (House, Apartment, etc.)
- `room_type`:
  * Entire home/apt (guests have entire place to themselves)
  * Private room (Guests have private room to sleep, all other rooms shared)
  * Shared room (Guests sleep in room shared with others)
- `number_of_reviews`: Total number of reviews for the listing
- `review_scores_rating`: Average review score (0 - 100)
- `longitude, latitude`: geographical coordinates to help us locate the listing
- `neighbourhood`: three variables on a few major neighbourhoods in each city
- `square_feet`: size of the listing in square feet
- `cancellation policy`: type of cancellation policy (flexible, moderate, strict)
- `host_is_identified`: indicates if the host has been validated by airbnb (True or False)
- `host_is_superhost`: if the host is experienced and has received consistently positive reviews

```{r, data frame simplification}
##selecting the needed variables 
df_fil <- df_raw %>%
  select(id,listing_url,
         price, cleaning_fee , extra_people, property_type,  room_type,
         number_of_reviews, review_scores_rating,  
         latitude ,longitude , is_location_exact,
         neighbourhood_cleansed , neighbourhood_group_cleansed, neighbourhood, 
         bathrooms,bedrooms,beds,
        host_identity_verified, host_is_superhost, accommodates,
        cancellation_policy, minimum_nights, guests_included)

```
```{r, numeric transformation}
# turn prices, cleaning_fee and extra people into a numeric column
#and removing the '$' and ','
df_fil <- transform(df_fil,price=as.numeric(sub("\\$","", sub(",","", price)),na.rm=TRUE),
                cleaning_fee=as.numeric(sub("\\$","", sub(",","", cleaning_fee)),na.rm=TRUE),
                extra_people=as.numeric(sub("\\$","", sub(",","", extra_people)),na.rm=TRUE))

```
```{r, remove duplicate listings and NAs} 
df_cleaned <- df_fil%>%
#removing duplicate ids 
 filter(duplicated(id) == FALSE) %>%
#removing listings with missing price
  filter(is.na(price) == FALSE)

```
  
In the following section I clean one variable at a time to improve data quality and the reliability of my results. 
After researching the listings I replace the NA in `cleaning_fee` with zero as these are AirBnBs that do not charge for cleaning or include the charge in the `price`.

```{r, cleaning fee NAs into 0}
#creating a new column with NAs replaced with zeros for cleaning fees 
df_cleaned <- df_cleaned %>%
  mutate(cleaning_fee_cleaned = 
case_when(is.na(cleaning_fee) ~ 0,
           TRUE ~ cleaning_fee))

```
Similarly, I replace the NAs for the variable `extra_people` with zeros. 
```{r, replace NA with 0 for extra people}

#creating a new column with NAs replaced with zeros for extra people 
df_cleaned <- df_cleaned %>%
  mutate(extra_people_clean = 
case_when(is.na(extra_people) ~ 0,
           TRUE ~ extra_people))

```
Next, I simplify the variable `property_type` by reducing it to the top 5 most common types and grouping the rest into a new category named *other*.
```{r, cleaning the property type column}

#adjusting the property type column 
df_cleaned <- df_cleaned %>% 
  mutate(prop_type_simplified = case_when( property_type %in% c("Apartment","Condominium", "Serviced apartment","House", "Hostel") ~ property_type, TRUE ~ "Other" ))

#visualizing the most common property types 
df_cleaned %>% group_by(prop_type_simplified) %>% 
  tally() %>% 
  arrange(desc(n)) %>% 
  rename("Property Type" = prop_type_simplified) %>% 
  #Formatting the table for HTML
kbl(caption = "Property type of AirBnB Listings in Singapore") %>% 
  kable_styling() 

```
For the variable `bedrooms` I noticed the unusual value of zero, as seen from the graph below. Upon further research I realized this referred to studios and hence decided to keep in the data frame without modification making the assumption that the zeros are not a mistake in the data but rather refer to listings such as studios. The same reasoning was applied for the zeros for the variable `beds`. However, I proceed to remove the missing values (NAs) from both.
```{r, fig.height=5, fig.width=11}
#removing NAs 
df_cleaned <- df_cleaned %>%   
filter(is.na(beds) == FALSE) %>%
  filter(is.na(bedrooms) == FALSE) 

#plotting historgram for price and price 4 nights
bedroom_plot <- df_cleaned %>%
  group_by(bedrooms) %>% 
  tally() %>% 

ggplot() +
  geom_col( aes(x = bedrooms, y = n), fill= fill_palette[1],alpha = 0.9) +
   geom_hline(aes(yintercept = 0), size = 1) +
  labs(title = "Listings with no Bedrooms in the data", 
       subtitle = "Distribution of the number of bedrooms",
        y = 'Count' , x  = 'Number of Bedrooms') +
  theme_cust

bed_plot <- df_cleaned %>%
  group_by(beds) %>% 
  tally() %>% 

ggplot() +
  geom_col( aes(x = beds, y = n), fill= fill_palette[1],alpha = 0.9) +
   geom_hline(aes(yintercept = 0), size = 1) +
  labs(title = "Listings with no Beds in the data", 
       subtitle = "Distribution of the number of bedrooms",
        y = 'Count' , x  = 'Number of beds') +
  theme_cust

grid.arrange(bed_plot ,bedroom_plot, nrow = 1)

```

As seen in the skim of the data, the variable `room_type` does not have missing values and hence I did not modify it.  

Next I inspect the `neighborhoods` and order them by number of listings. Singapore has a total of 40 neighbourhoods, which, for the purpose of my analysis have been grouped into 5 macro-areas.
```{r, neighbourhoods}

#inspecting neighborhoods and ordering them by number of listings
df_cleaned %>% group_by(neighbourhood_group_cleansed) %>% 
  tally() %>% 
  arrange(desc(n)) %>% 
  rename("Area"= neighbourhood_group_cleansed, "Total Listings" = n) %>% 
  #Formatting the table for HTML
kbl(caption = "Concentration of AirBnB Listings in Singapore's 5 main areas") %>% 
  kable_styling()

```
Some of the observations are also missing data points (NAs) for the variables`host_is_identified` and `host_is_superhost`, which I remove below. 

I also remove the observations which lack a data point for `review_scores_rating`. Whilst I are aware that this will reduce the volume of the data frame significantly (of almost 3000 observations), I want to prioritize the quality of the data over the quantity and are confident that the remaining data frame represents a sufficient sample size for a reliable analysis. 
```{r} 
df_cleaned <- df_cleaned %>%
#remove NAs
  filter(is.na(host_is_superhost) == FALSE) %>%
#remove NAs
  filter(is.na(host_identity_verified) == FALSE) %>%
#I remove NAs 
  filter(is.na(review_scores_rating) == FALSE) 

```
Given that I want to analyse a stay  of 4 nights I will be filtering out from the data frame the listings that require a minimum of a 5 night stay.
```{r} 
df_cleaned <- df_cleaned %>%
#remove listings that do not require more than 4 nights 
  filter(minimum_nights < 5) 

```
I update the data frame by removing the now outdated columns, which have been cleaned above and compute accomodation cost for 4 nights for 2 people.  
```{r, }

df_final <- df_cleaned %>% 
  #removing unwanted columns from the data frame 
  select(-c(cleaning_fee, property_type, extra_people)) %>% 
  #create a new column with tot price for 4 nights for 2 people per listing
  mutate(extra_cost = as.numeric(guests_included < 2)) %>%
  mutate(price_4_nights= price*4 +cleaning_fee_cleaned+extra_cost*extra_people_clean)

```
```{r, eval = FALSE}

#I skim the updated data frame
skim(df_final)

```





